import { BigNumber } from 'ethers';

// status codes from the Deposit contract
export enum DepositStatus {
  START,

  // FUNDING FLOW
  AWAITING_SIGNER_SETUP,
  AWAITING_BTC_FUNDING_PROOF,

  // FAILED SETUP
  FAILED_SETUP,

  // ACTIVE
  ACTIVE, // includes courtesy call

  // REDEMPTION FLOW
  AWAITING_WITHDRAWAL_SIGNATURE,
  AWAITING_WITHDRAWAL_PROOF,
  REDEEMED,

  // SIGNER LIQUIDATION FLOW
  COURTESY_CALL,
  FRAUD_LIQUIDATION_IN_PROGRESS,
  LIQUIDATION_IN_PROGRESS,
  LIQUIDATED,

  // KEEPER-SPECIFIC (NON-STANDARD STATUS CODES)
  KEEPER_QUEUED_FOR_REDEMPTION,
  KEEPER_REDEEMING,
  KEEPER_REDEEMED,
  KEEPER_REDEEM_ERROR,
}

export enum DepositOperationLogType {
  // redeeming
  REDEEM_APPROVE_TBTC_BROADCASTED = 'REDEEM_APPROVE_TBTC_BROADCASTED', // TODO: approve once?
  REDEEM_APPROVE_TBTC_CONFIRMED = 'REDEEM_APPROVE_TBTC_CONFIRMED',
  REDEEM_APPROVE_TBTC_ERROR = 'REDEEM_APPROVE_TBTC_ERROR',

  REDEEM_TBTC_TO_BTC_BROADCASTED = 'REDEEM_TBTC_TO_BTC_BROADCASTED',
  REDEEM_TBTC_TO_BTC_CONFIRMED = 'REDEEM_TBTC_TO_BTC_CONFIRMED',
  REDEEM_TBTC_TO_BTC_ERROR = 'REDEEM_TBTC_TO_BTC_ERROR',

  REDEEM_PROVIDE_REDEMPTION_SIG_BROADCASTED = 'REDEEM_PROVIDE_REDEMPTION_SIG_BROADCASTED',
  REDEEM_PROVIDE_REDEMPTION_SIG_CONFIRMED = 'REDEEM_PROVIDE_REDEMPTION_SIG_CONFIRMED',
  REDEEM_PROVIDE_REDEMPTION_SIG_ERROR = 'REDEEM_PROVIDE_REDEMPTION_SIG_ERROR',

  REDEEM_BTC_RECEPTION_CONFIRMED = 'REDEEM_BTC_RECEPTION_CONFIRMED',
  REDEEM_BTC_RECEPTION_ERROR = 'REDEEM_BTC_RECEPTION_ERROR',

  REDEEM_PROVIDE_REDEMPTION_PROOF_BROADCASTED = 'REDEEM_PROVIDE_REDEMPTION_PROOF_BROADCASTED',
  REDEEM_PROVIDE_REDEMPTION_PROOF_CONFIRMED = 'REDEEM_PROVIDE_REDEMPTION_PROOF_CONFIRMED',
  REDEEM_PROVIDE_REDEMPTION_PROOF_ERROR = 'REDEEM_PROVIDE_REDEMPTION_PROOF_ERROR',

  // minting
  MINT_START = 'MINT_START',
  MINT_CREATE_DEPOSIT = 'MINT_CREATE_DEPOSIT',
  MINT_RETRIEVE_PUBKEY = 'MINT_RETRIEVE_PUBKEY',
  MINT_FUND_BTC = 'MINT_FUND_BTC',
  MINT_PROVIDE_FUNDING_PROOF = 'MINT_PROVIDE_FUNDING_PROOF',
  MINT_APPROVE_TDT = 'MINT_APPROVE_TDT', // TODO: approve once?
  MINT_TDT_TO_TBTC = 'MINT_TDT_TO_TBTC',
  MINT_TBTC_RECEPTION = 'MINT_TBTC_RECEPTION',
}

export enum DepositOperationStatus {
  START = 'START',
  CONFIRMING = 'CONFIRMING',
  CONFIRMED = 'CONFIRMED',
  ERROR = 'ERROR',
}

export enum PubSubTopic {
  REDEEM_START = 'REDEEM_START',
}

export enum BlockchainType {
  ETHEREUM = 'ETHEREUM',
  BITCOIN = 'BITCOIN',
}

export interface IDepositContract {
  getStatusCode(): Promise<number>;
  getKeepAddress(): Promise<string>;
  getLotSizeSatoshis(): Promise<BigNumber>;
  getCollateralizationPercent(): Promise<number>;
  getUndercollateralizedThresholdPercent(): Promise<number>;
  getRedemptionCost(): Promise<BigNumber>;
  getRedemptionFee(): Promise<BigNumber>;
}
